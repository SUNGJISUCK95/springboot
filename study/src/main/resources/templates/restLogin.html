<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script>
        async function handelSubmit() {
            //console.log("login 버튼 클릭");

            //1. id, pass 값 가져온 후 JSON 객체 생성

            const id = document.getElementById("id").value;
            const pass = document.getElementById("pass").value;
            const formData =
            {
                "id": id,
                "pass": pass
            }
            //console.log("id, pass => ", id, pass);
            //console.log("formData => ", formData);

            //2. PostMapping으로 MemberRestController에 JSON 객체 전송
            //   --> await fetch 함수 요청(request) 및 응답(response) 생성

            //const response = await fetch("URL", { //react때는 react쪽 url 넣어야함 3030포트
            //    method: "POST",
            //    headers: { 전송하는 객체 타입 },
            //    body: { 전송 데이터 }
            //});

            const response = await fetch("http://localhost:8080/restLogin", {
                method: "POST",
                headers: { "Content-Type": "application/json", },
                body: JSON.stringify(formData)
            });

            console.log(response);

            //3. 응답 객체를 통한 결과를 출력

            if(response.ok) {
                const { result, member } = await response.json(); //response를 받아오는 작업도 비동기임
                                                                  //{ "result":result, "member":member }
                                                                  //Object Literal 작업을 자동으로 해줌
                console.log(result, member);

                if(result) {
                    alert("로그인 성공");
                    const output = `
                        <ul>
                            <li>아이디 : ${member.id}</li>
                            <li>패스워드 : ${member.pass}</li>
                        </ul>
                    `;

                    document.getElementById("result").innerHTML = output;
                }else {
                    //document.getElementById("result").remove();
                    alert("로그인 실패");
                }
            }
        }
    </script>
</head>
<body>
    <h1>Login(REST) 화면</h1> <!--REST는 form 사용하지 않음 -->
    <ul>
        <li>
            <label>아이디</label>
            <input type="text" id="id"> <!-- REST에선 입력된 파라미터(데이터)는 id로 넘어간다.-->
        </li>
        <li>
            <label>패스워드</label>
            <input type="password" id="pass"> <!-- REST에선 입력된 파라미터(데이터)는 id로 넘어간다.-->
        </li>
        <li>
            <button type="submit" onClick="handelSubmit()" >로그인</button>
            <button type="reset">재입력</button>
        </li>
    </ul>
    <hr>
    <div id="result"></div>
    <a href="/">홈으로</a>
</body>
</html>